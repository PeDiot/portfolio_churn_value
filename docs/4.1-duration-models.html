<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4.1 Duration models | Portfolio, Churn &amp; Customer Value</title>
  <meta name="description" content="This research paper aims at modelling customer portfolio, churn and customer value." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4.1 Duration models | Portfolio, Churn &amp; Customer Value" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This research paper aims at modelling customer portfolio, churn and customer value." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4.1 Duration models | Portfolio, Churn &amp; Customer Value" />
  
  <meta name="twitter:description" content="This research paper aims at modelling customer portfolio, churn and customer value." />
  

<meta name="author" content="Hugo Cornet, Pierre-Emmanuel Diot, Guillaume Le Halper, Djawed Mancer" />


<meta name="date" content="2021-12-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-framework.html"/>
<link rel="next" href="4.2-ML.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Portfolio, Churn & Customer Value</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Abstract</a></li>
<li class="chapter" data-level="1" data-path="1-intro.html"><a href="1-intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1.1-context.html"><a href="1.1-context.html"><i class="fa fa-check"></i><b>1.1</b> Context</a></li>
<li class="chapter" data-level="1.2" data-path="1.2-a-multi-purpose-study.html"><a href="1.2-a-multi-purpose-study.html"><i class="fa fa-check"></i><b>1.2</b> A multi-purpose study</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-definitions.html"><a href="2-definitions.html"><i class="fa fa-check"></i><b>2</b> Definitions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2.1-how-to-define-a-customer-portfolio.html"><a href="2.1-how-to-define-a-customer-portfolio.html"><i class="fa fa-check"></i><b>2.1</b> How to define a customer portfolio?</a></li>
<li class="chapter" data-level="2.2" data-path="2.2-what-is-attrition.html"><a href="2.2-what-is-attrition.html"><i class="fa fa-check"></i><b>2.2</b> What is attrition?</a></li>
<li class="chapter" data-level="2.3" data-path="2.3-what-does-customer-value-mean.html"><a href="2.3-what-does-customer-value-mean.html"><i class="fa fa-check"></i><b>2.3</b> What does customer “value” mean?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-literature.html"><a href="3-literature.html"><i class="fa fa-check"></i><b>3</b> Literature Review</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3.1-portfolio.html"><a href="3.1-portfolio.html"><i class="fa fa-check"></i><b>3.1</b> On customer portfolio</a></li>
<li class="chapter" data-level="3.2" data-path="3.2-attrition.html"><a href="3.2-attrition.html"><i class="fa fa-check"></i><b>3.2</b> On attrition</a></li>
<li class="chapter" data-level="3.3" data-path="3.3-value.html"><a href="3.3-value.html"><i class="fa fa-check"></i><b>3.3</b> On customer value</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-framework.html"><a href="4-framework.html"><i class="fa fa-check"></i><b>4</b> Theoretical Framework</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4.1-duration-models.html"><a href="4.1-duration-models.html"><i class="fa fa-check"></i><b>4.1</b> Duration models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4.1-duration-models.html"><a href="4.1-duration-models.html#censoring-and-truncation"><i class="fa fa-check"></i><b>4.1.1</b> Censoring and Truncation</a></li>
<li class="chapter" data-level="4.1.2" data-path="4.1-duration-models.html"><a href="4.1-duration-models.html#probabilistic-concepts"><i class="fa fa-check"></i><b>4.1.2</b> Probabilistic concepts</a></li>
<li class="chapter" data-level="4.1.3" data-path="4.1-duration-models.html"><a href="4.1-duration-models.html#nonparametric-models"><i class="fa fa-check"></i><b>4.1.3</b> Nonparametric models</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4.2-ML.html"><a href="4.2-ML.html"><i class="fa fa-check"></i><b>4.2</b> Machine Learning techniques</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-data.html"><a href="5-data.html"><i class="fa fa-check"></i><b>5</b> Data</a></li>
<li class="chapter" data-level="" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i>Appendix</a>
<ul>
<li class="chapter" data-level="" data-path="duration-models-1.html"><a href="duration-models-1.html"><i class="fa fa-check"></i>Duration models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Portfolio, Churn &amp; Customer Value</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="duration-models" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Duration models</h2>
<p>According to Cameron &amp; Trivedi <span class="citation">(<a href="#ref-CAMERON_TRIVEDI" role="doc-biblioref">Cameron and Trivedi 2005</a>)</span>, duration models (also called survival models) aims at measuring the time spent in a certain state before transitioning to another state. In Econometrics,</p>
<ul>
<li>a <strong>state</strong> corresponds to the class in which an individual <span class="math inline">\(i\)</span> is at time <span class="math inline">\(t\)</span>.</li>
<li>a <strong>transition</strong> is movement from one state to another.</li>
<li>a <strong>duration</strong> measures the time spent in a certain state and is also called a <strong>spell</strong> length.</li>
</ul>
<p>Since measuring the time until the event is needed for multiple purposes, duration analysis is used in a variety of economic sectors as depicted by the following table.</p>
<table>
<thead>
<tr class="header">
<th align="center">Economic sector</th>
<th align="center">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Macroeconomics</td>
<td align="center">Length of an unemployment spell</td>
</tr>
<tr class="even">
<td align="center">Insurance</td>
<td align="center">Risk analysis to offer a segmented pricing</td>
</tr>
<tr class="odd">
<td align="center">Engineering</td>
<td align="center">Time until a device breaks down</td>
</tr>
<tr class="even">
<td align="center">Epidemiology</td>
<td align="center">Survival time of a virus</td>
</tr>
<tr class="odd">
<td align="center"><strong>Churn analysis</strong></td>
<td align="center"><strong>Time until a customer leave the portfolio</strong></td>
</tr>
</tbody>
</table>
<div id="censoring-and-truncation" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Censoring and Truncation</h3>
<p>When dealing with survival data, some observations are usually <strong>censored</strong> meaning they are related to spells which are not completely observed. Duration data can also suffer from a selection bias which is called <strong>truncation</strong>.</p>
<div id="censoring-mechanisms" class="section level4 unnumbered">
<h4>Censoring mechanisms</h4>
<p><strong>Left-censoring</strong> occurs when the event of interest occurs before the beginning of the observation period. For example, an individual is included in a study of duration of unemployment at <span class="math inline">\(t_0\)</span>. At that time he has already been unemployed for a period but he cannot recall exactly the duration of this period. If we observe that he finds a job again at <span class="math inline">\(t_1\)</span>, we can only deduce that the duration of unemployment is bigger than <span class="math inline">\(t_1-t_0\)</span>, this individual is left-censored. Observation 2 on figure <a href="4.1-duration-models.html#fig:censoring">4.1</a> is associated with a left-censored spell <span class="citation">(<a href="#ref-LIU_SCOR" role="doc-biblioref">Liu 2019</a>)</span>.</p>
<p>A spell is considered <strong>right-censored</strong> when it is observed from time <span class="math inline">\(t_0\)</span> until a censoring time <span class="math inline">\(t_c\)</span> as illustrated by observation 1 on figure <a href="4.1-duration-models.html#fig:censoring">4.1</a>. For instance, the lifetime related to a customer who has not churned at the end of the observation period is right-censored. Let us note <span class="math inline">\(X_i\)</span> the duration of a complete spell and <span class="math inline">\(C_i\)</span> the duration of a right-censored spell. We also note <span class="math inline">\(T_i\)</span> the duration actually observed and <span class="math inline">\(\delta_i\)</span> the censoring indicator such that <span class="math inline">\(\delta_i = 0\)</span> if the spell is censored. Then, <span class="math inline">\((t_1, \delta_1),\dots,(t_N, \delta_N)\)</span> are the realizations of the following random variables:</p>
<p><span class="math display" id="eq:censoring">\[\begin{equation}
  \begin{aligned}
  T_i &amp; = \min(X_i, C_i) \\
  \delta_i &amp; = \mathbb{1}_{X_i &lt; C_i}
  \end{aligned}
  \tag{4.1}
\end{equation}\]</span></p>
</div>
<div id="selection-bias" class="section level4 unnumbered">
<h4>Selection bias</h4>
<p>Survival data suffers from a <strong>selection bias</strong> (or truncation) when only a sub-sample of the population of interest is studied. A customer entering the firm’s portfolio after the end of the study is said to be <strong>right-truncated</strong>, whereas a client who has left the portfolio before the beginning of the study is considered <strong>left-truncated</strong>. Mathematically, a random variable <span class="math inline">\(X\)</span> is truncated by a subset <span class="math inline">\(A \in \mathbb{R}^+\)</span> if instead of <span class="math inline">\(\Omega(X)\)</span>, we solely observe <span class="math inline">\(\Omega(X)\bigcap A\)</span>. On figure <a href="4.1-duration-models.html#fig:censoring">4.1</a>, the first and fifth observations suffers from a selection bias.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:censoring"></span>
<img src="imgs/censoring_and_truncation.png" alt="Censored and truncated data" width="500px" height="250px" />
<p class="caption">
Figure 4.1: Censored and truncated data
</p>
</div>
</div>
</div>
<div id="probabilistic-concepts" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Probabilistic concepts</h3>
<p>In survival analysis, the response variable denoted <span class="math inline">\(T\)</span> is a time-to-event variable. Instead of estimating the expected failure time, survival models estimate the <em>survival</em> and <em>hazard rate</em> functions which depend on the realization of <span class="math inline">\(T\)</span>.</p>
<div id="survival-function" class="section level4 unnumbered">
<h4>Survival function</h4>
<p>The survival function <span class="math inline">\(S(t)\)</span> represents the probability that the considered event occurs after time <span class="math inline">\(t\)</span>. For instance, <span class="math inline">\(S(t)\)</span> can measure the probability that a given customer survive in the portfolio at least until time <span class="math inline">\(t\)</span>. Mathematically, the survival function is defined as:
<span class="math display" id="eq:survfun">\[\begin{equation}
  S(t) = P(T &gt; t) = 1 - F(t)
  \tag{4.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(F(t)\)</span> is the cumulative distribution function.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:survfunplot"></span>
<img src="imgs/surv_fun_plot.png" alt="Survival function $S_T(t)$ with $T \sim \mathcal{E} (1)$" width="400px" height="300px" />
<p class="caption">
Figure 4.2: Survival function <span class="math inline">\(S_T(t)\)</span> with <span class="math inline">\(T \sim \mathcal{E} (1)\)</span>
</p>
</div>
</div>
<div id="hazard-and-cumulative-hazard-functions" class="section level4 unnumbered">
<h4>Hazard and Cumulative Hazard functions</h4>
<p>Another key concept in duration analysis is the hazard function <span class="math inline">\(\lambda(t)\)</span> which approximates the probability that the event occurs at time <span class="math inline">\(t\)</span>. For instance, <span class="math inline">\(\lambda(t)\)</span> can measure the probability that a given individual leaves the firm portfolio at time <span class="math inline">\(t\)</span>. Formally, it is expressed as follows:
<span class="math display" id="eq:hazfun">\[\begin{equation}
  \lambda(t) = \lim_{\Delta t \to 0} \frac{P\big[t \leq T &lt; t + \Delta t | T \geq t \big]}{\Delta t}
  \tag{4.3}
\end{equation}\]</span></p>
<p>Using the Bayes formula, equation <a href="4.1-duration-models.html#eq:hazfun">(4.3)</a> can also be written as (see equation <a href="duration-models-1.html#eq:hazfunproof">(5.1)</a> in appendix):
<span class="math display" id="eq:hazfunbis">\[\begin{equation}
  \lambda(t) = \frac{-\text{d} \ln \big(S(t)\big)}{\text{d} t}
  \tag{4.4}
\end{equation}\]</span></p>
<p>Finally, integrating the instantaneous hazard function gives the cumulative hazard function which can be more precisely estimated than the hazard function <span class="citation">(<a href="#ref-CAMERON_TRIVEDI" role="doc-biblioref">Cameron and Trivedi 2005</a>)</span> and is defined as:</p>
<p><span class="math display" id="eq:cumhazfun">\[\begin{equation}
  \Lambda (t) = \int_{0}^{t} \lambda(s) \text{d}s = \ln \big(S(t)\big)
  \tag{4.5}
\end{equation}\]</span></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cumhazplot"></span>
<img src="imgs/cum_haz_plot.png" alt="Cumulative Hazard function $\Lambda_T(t)$ with $T \sim \mathcal{E} (1)$" width="400px" height="300px" />
<p class="caption">
Figure 4.3: Cumulative Hazard function <span class="math inline">\(\Lambda_T(t)\)</span> with <span class="math inline">\(T \sim \mathcal{E} (1)\)</span>
</p>
</div>
<p>Thus, the hazard, survival and cumulative hazard functions are three mathematical functions which describe the same distribution.</p>
</div>
</div>
<div id="nonparametric-models" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Nonparametric models</h3>
<p>When dealing with duration data, these methods are helpful to have a general overview of the raw (unconditional) hazard. Nonparametric models are rather used for data description rather than prediction. No explanatory variable is included in these models except for treatment variables such as the type of contract a customer has subscribe.</p>
<div id="notations" class="section level4 unnumbered">
<h4>Notations</h4>
<p>Let us consider a sample with <span class="math inline">\(N\)</span> observations with <span class="math inline">\(k\)</span> discrete failure time (e.g. a failure can be a churn event), such that <span class="math inline">\(\forall j \in [\![1; k]\!]\)</span> :</p>
<ul>
<li><span class="math inline">\(t_j\)</span> the <span class="math inline">\(j^{\text{th}}\)</span> discrete failure time,</li>
<li><span class="math inline">\(d_j\)</span> the number of spells terminating at <span class="math inline">\(t_j\)</span>,</li>
<li><span class="math inline">\(m_j\)</span> the number of right-censored spells in the interval <span class="math inline">\([t_j, t_{j+1}]\)</span>,</li>
<li><span class="math inline">\(r_j\)</span> the number of exposed durations right before time <span class="math inline">\(t_j\)</span> such that:
<span class="math display" id="eq:exposed">\[\begin{equation}
r_j = (d_j + m_j) + \dots + (d_k + m_k) = \sum_{l|l \geq j} (d_l + m_l)
\tag{4.6}
\end{equation}\]</span></li>
</ul>
</div>
<div id="hazard-function-estimator" class="section level4 unnumbered">
<h4>Hazard function estimator</h4>
<p>As the instantaneous hazard at time <span class="math inline">\(t_j\)</span> is defined as <span class="math inline">\(\lambda_j = P[T=t_j|T\geq t_j]\)</span>, a trivial estimator of <span class="math inline">\(\lambda_j\)</span> is obtained by dividing the number of durations for which the event is realized in <span class="math inline">\(t_j\)</span> by the total number of exposed durations at time <span class="math inline">\(t_j^{-}\)</span>. Formally, it is expressed as:</p>
<p><span class="math display" id="eq:hazest">\[\begin{equation}
  \hat{\lambda}_j = \frac{d_j}{r_j}
  \tag{4.7}
\end{equation}\]</span></p>
</div>
<div id="kaplan-meier-estimator" class="section level4 unnumbered">
<h4>Kaplan-Meier estimator</h4>
<p>Once the hazard function estimator computed, the discrete-time survivor function can be estimated using the Kaplan-Meier estimator. To estimate the survival at time <span class="math inline">\(t\)</span>, this estimator computes the joint probability that a spell stays in the same state until <span class="math inline">\(t\)</span> (e.g. remaining loyal to a firm until a certain time). Mathematically, we have:</p>
<p><span class="math display" id="eq:kaplanmeier">\[\begin{equation}
  \hat{S}(t) = \Pi_{j|t_j \leq t} \big(1-\hat{\lambda}_j\big) = \Pi_{j|t_j \leq t}\frac{r_j - d_j}{r_j}
  \tag{4.8}
\end{equation}\]</span></p>
<p>When plotting the survival curve after having performed the Kaplan-Meier estimation, confidence bands are also added to the plot in order to reflect sampling variability <span class="citation">(<a href="#ref-CAMERON_TRIVEDI" role="doc-biblioref">Cameron and Trivedi 2005</a>)</span>. The confidence interval of the survival function <span class="math inline">\(S(t)\)</span> is derived from the estimate of the variance of <span class="math inline">\(S(t)\)</span> which is obtained by the Grenwood estimate (see equation <a href="4.1-duration-models.html#eq:greenwood">(4.9)</a>).</p>
<p><span class="math display" id="eq:greenwood">\[\begin{equation}
  \hat{\mathrm{V}}[\hat{S}(t)] = \hat{S}(t)^2 \sum_{j|t_j \leq t} \frac{d_j}{r_j(r_j-d_j)}
  \tag{4.9}
\end{equation}\]</span></p>
</div>
<div id="nelson-aalen-estimator" class="section level4 unnumbered">
<h4>Nelson-Aalen estimator</h4>
<p>The cumulative hazard function estimate is given by the Nelson-Aalen estimator which consists in summing up the hazard estimates for each failure time.</p>
<p><span class="math display" id="eq:nelsonaalen">\[\begin{equation}
  \hat{\Lambda}(t) = \sum_{j | t_j \leq t} \hat{\lambda}_{j} = \sum_{j | t_j \leq t} \frac{d_j}{r_j}
  \tag{4.10}
\end{equation}\]</span></p>
<p>Exponentiating <span class="math inline">\(\hat{\Lambda}(t)\)</span>, one can obtain a second estimate of the survival function (see equation <a href="duration-models-1.html#eq:linksurvcumhaz">(5.2)</a> in the appendix):</p>
<p><span class="math display" id="eq:survest">\[\begin{equation}
    \tilde{S}(t) = \exp \big( -\hat{\Lambda}(t) \big)
    \tag{4.11}
\end{equation}\]</span></p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-CAMERON_TRIVEDI" class="csl-entry">
Cameron, A. Colin, and Pravin K. Trivedi. 2005. <em>Microeconometrics: Methods and Applications</em>. Edited by Cambridge University Press.
</div>
<div id="ref-LIU_SCOR" class="csl-entry">
Liu, Weinan. 2019. <span>“Inclusive Underwriting: The Case of Cardiovascular Risk Calculator.”</span> PhD thesis, ENSAE ParisTech.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-framework.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="4.2-ML.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
